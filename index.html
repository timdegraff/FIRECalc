<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>FIRECalc</title>
    <script>
        if (window.innerWidth < 768 && !window.location.search.includes('desktop')) {
            window.location.href = 'mobile.html';
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“ˆ</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    <script type="importmap">
    {
      "imports": {
        "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
        "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
        "react/": "https://esm.sh/react@^19.2.3/",
        "react": "https://esm.sh/react@^19.2.3"
      }
    }
    </script>
</head>
<body class="text-slate-300 bg-[#0B0F19] font-inter">

    <!-- Loading State -->
    <div id="login-screen" class="fixed inset-0 flex items-center justify-center bg-[#0B0F19] z-50">
        <div class="p-8 text-center w-full">
            <h1 class="text-4xl font-black mb-2 text-white tracking-tighter">FIRECalc</h1>
            <div class="flex items-center justify-center gap-3 text-blue-500 font-bold uppercase tracking-widest text-xs mt-8">
                <i class="fas fa-circle-notch fa-spin text-lg"></i>
                Authenticating...
            </div>
        </div>
    </div>

    <!-- Guest Warning Modal -->
    <div id="guest-modal" class="fixed inset-0 flex items-center justify-center bg-black/80 z-[60] hidden backdrop-blur-sm">
        <div class="glass-panel p-8 rounded-[24px] shadow-2xl max-w-md text-center mx-4 relative">
            <div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-white/10">
                <i class="fas fa-hdd text-3xl text-blue-400"></i>
            </div>
            <h2 class="text-2xl font-black text-white mb-2 tracking-tight">Guest Mode</h2>
            <p class="text-slate-400 text-sm leading-relaxed mb-8">
                Data is stored <strong class="text-white">locally on this device</strong>. <br>
                Clear your cache and it's gone.
            </p>
            <button id="ack-guest-btn" class="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold transition-all shadow-lg shadow-blue-900/20 uppercase tracking-widest text-xs">
                I Understand
            </button>
        </div>
    </div>

    <div id="app-container" class="hidden flex h-screen overflow-hidden relative">
        <!-- Sidebar: Glass Effect -->
        <aside class="sidebar w-64 flex flex-col flex-shrink-0 bg-[#0B0F19]/80 backdrop-blur-xl border-r border-white/5 z-20">
            <div class="p-6 pb-2">
                <div class="flex items-center justify-between mb-1">
                    <h1 class="text-xl font-black text-white tracking-tight">FIRECalc</h1>
                    <!-- Buy Me a Coffee -->
                    <div class="flex items-center gap-1.5">
                        <span class="text-[9px] font-black text-amber-500 uppercase tracking-widest">Donate:</span>
                        <a href="https://buymeacoffee.com/timdegraff" target="_blank" class="text-amber-500 hover:text-amber-400 transition-colors text-xs" title="Buy me a coffee">
                            <i class="fas fa-coffee"></i>
                        </a>
                    </div>
                </div>
                <p class="label-std text-slate-500">Retirement Engine</p>
            </div>
            
            <nav class="flex-grow px-3 py-2 space-y-1 overflow-y-auto" id="main-nav">
                <button data-tab="assets-debts" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-wallet w-5 text-center text-orange-400"></i><span>Assets</span></button>
                <button data-tab="income" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-money-bill-wave w-5 text-center text-teal-400"></i><span>Income</span></button>
                <button data-tab="budget" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-chart-pie w-5 text-center text-pink-500"></i><span>Budget</span></button>
                <button data-tab="assumptions" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-sliders-h w-5 text-center text-emerald-400"></i><span>Assumptions</span></button>
                <button data-tab="benefits" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-hand-holding-heart w-5 text-center text-amber-400"></i><span>Benefits</span></button>
                <button data-tab="projection" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-chart-line w-5 text-center text-blue-400"></i><span>Projection</span></button>
                <button data-tab="burndown" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-stairs w-5 text-center text-purple-400" style="transform: scaleX(-1);"></i><span>Burndown</span></button>
            </nav>
            
            <div class="p-4 border-t border-white/5 bg-black/10">
                <div class="mb-4">
                    <p class="label-std text-slate-500 mb-1">Net Worth</p>
                    <p id="sidebar-networth" class="text-lg font-black text-emerald-400 tracking-tight mono-numbers">$0</p>
                    <div id="sidebar-asset-legend" class="grid grid-cols-2 gap-x-4 gap-y-1 w-full mt-3"></div>
                </div>
                <div class="flex items-center gap-3 mb-3">
                    <img id="user-avatar" class="w-8 h-8 rounded-full border border-white/10" src="" alt="">
                    <p id="user-name" class="font-bold text-slate-300 text-[11px] truncate"></p>
                </div>
                <div class="flex gap-2">
                    <!-- Save Indicator -->
                    <div id="save-indicator" class="flex-1 py-1.5 bg-white/5 rounded-lg text-center flex items-center justify-center gap-1 border border-white/5 text-slate-600 transition-colors duration-200" title="Data Sync Status">
                        <i class="fas fa-cloud text-xs"></i>
                    </div>
                    <button id="logout-btn" class="flex-[3] py-1.5 bg-white/5 hover:bg-red-500/20 text-slate-400 hover:text-red-400 rounded-lg text-[10px] font-bold uppercase tracking-wider transition-colors border border-white/5">Logout</button>
                </div>
            </div>
        </aside>

        <main class="main-content flex-grow p-6 md:p-8 overflow-y-auto bg-[#0B0F19]">
            <!-- Assets & Debts Tab -->
            <section id="tab-assets-debts" class="tab-content max-w-7xl mx-auto">
                <!-- Summary Widgets -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Total Assets</p>
                        <p id="sum-assets" class="text-4xl font-black text-emerald-400 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Total Liabilities</p>
                        <p id="sum-liabilities" class="text-4xl font-black text-red-400 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28 relative overflow-hidden group">
                        <div class="absolute inset-0 bg-teal-500/5 group-hover:bg-teal-500/10 transition-colors"></div>
                        <p class="label-std mb-2 text-teal-500">Net Worth</p>
                        <p id="sum-networth" class="text-4xl font-black text-teal-400 mono-numbers tracking-tight relative z-10">$0</p>
                    </div>
                </div>

                <!-- Investments Table -->
                <div class="mb-12">
                    <div class="flex justify-between items-end mb-6 px-1">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center text-orange-500 shadow-lg shadow-orange-500/10">
                                <i class="fas fa-chart-line text-sm"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-white tracking-tight">Investments</h2>
                                <p class="text-xs text-slate-500 font-medium mt-0.5">Liquid assets and retirement accounts</p>
                            </div>
                        </div>
                        <button data-add-row="investment-rows" data-row-type="investment" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-all shadow-lg shadow-blue-900/20"><i class="fas fa-plus mr-2"></i>Add Account</button>
                    </div>
                    <div class="card-container overflow-hidden">
                        <table class="w-full text-xs">
                            <thead class="text-slate-500 label-std border-b border-white/5">
                                <tr><th class="w-6"></th><th class="text-left w-[35%]">Account Name</th><th class="text-left w-[20%]">Asset Class</th><th class="text-right group cursor-pointer w-[20%]" data-sort="value" data-target="investment-rows">Value <i class="fas fa-sort ml-1 opacity-20"></i></th><th class="text-right w-[20%]">Cost Basis</th><th class="w-6"></th></tr>
                            </thead>
                            <tbody id="investment-rows" class="mono-numbers"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Real Estate & HELOCs Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                    <div>
                        <div class="flex justify-between items-center mb-6 px-1">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400">
                                    <i class="fas fa-home text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white tracking-tight">Real Estate</h3>
                                    <p class="text-xs text-slate-500 font-medium mt-0.5">Primary home and properties</p>
                                </div>
                            </div>
                            <button data-add-row="real-estate-rows" data-row-type="realEstate" class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors shadow-lg shadow-blue-900/20"><i class="fas fa-plus text-xs"></i></button>
                        </div>
                        <div class="card-container overflow-hidden">
                            <table class="w-full text-xs">
                                <thead><tr><th class="text-left w-[40%]">Property</th><th class="text-right w-[22%]">Value</th><th class="text-right w-[18%]">Mortgage</th><th class="text-right w-[15%]">Principal</th><th class="w-6"></th></tr></thead>
                                <tbody id="real-estate-rows" class="mono-numbers"></tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-6 px-1">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-xl bg-red-500/20 flex items-center justify-center text-red-400">
                                    <i class="fas fa-university text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white tracking-tight">HELOCs</h3>
                                    <p class="text-xs text-slate-500 font-medium mt-0.5">Secured lines of credit</p>
                                </div>
                            </div>
                            <button data-add-row="heloc-rows" data-row-type="heloc" class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors shadow-lg shadow-blue-900/20"><i class="fas fa-plus text-xs"></i></button>
                        </div>
                        <div class="card-container overflow-hidden">
                            <table class="w-full text-xs">
                                <thead><tr><th class="text-left w-[40%]">Name</th><th class="text-right w-[20%]">Balance</th><th class="text-right w-[20%]">Limit</th><th class="text-center w-[12%]">Rate %</th><th class="w-6"></th></tr></thead>
                                <tbody id="heloc-rows" class="mono-numbers"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Other Assets & Debts Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                    <div>
                        <div class="flex justify-between items-center mb-6 px-1">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-xl bg-teal-500/20 flex items-center justify-center text-teal-400">
                                    <i class="fas fa-car text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white tracking-tight">Other Assets</h3>
                                    <p class="text-xs text-slate-500 font-medium mt-0.5">Vehicles and collectibles</p>
                                </div>
                            </div>
                            <button data-add-row="other-assets-rows" data-row-type="otherAsset" class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors shadow-lg shadow-blue-900/20"><i class="fas fa-plus text-xs"></i></button>
                        </div>
                        <div class="card-container overflow-hidden">
                            <table class="w-full text-xs">
                                <thead><tr><th class="text-left w-[45%]">Asset</th><th class="text-right w-[25%]">Value</th><th class="text-right w-[24%]">Loan</th><th class="w-6"></th></tr></thead>
                                <tbody id="other-assets-rows" class="mono-numbers"></tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-6 px-1">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-xl bg-red-500/20 flex items-center justify-center text-red-400">
                                    <i class="fas fa-credit-card text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white tracking-tight">Other Debt</h3>
                                    <p class="text-xs text-slate-500 font-medium mt-0.5">Unsecured loans and credit</p>
                                </div>
                            </div>
                            <button data-add-row="debt-rows" data-row-type="debt" class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors shadow-lg shadow-blue-900/20"><i class="fas fa-plus text-xs"></i></button>
                        </div>
                        <div class="card-container overflow-hidden">
                            <table class="w-full text-xs">
                                <thead><tr><th class="text-left w-[45%]">Creditor</th><th class="text-right w-[25%]">Balance</th><th class="text-right w-[24%]">Payment</th><th class="w-6"></th></tr></thead>
                                <tbody id="debt-rows" class="mono-numbers"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="mb-12">
                    <div class="flex justify-between items-center mb-6 px-1">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
                                <i class="fas fa-briefcase text-sm"></i>
                            </div>
                            <div>
                                <h2 class="text-lg font-bold text-white tracking-tight">Private Equity</h2>
                                <p class="text-xs text-slate-500 font-medium mt-0.5">Stock options and grants</p>
                            </div>
                        </div>
                        <button data-add-row="stock-option-rows" data-row-type="stockOption" class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors shadow-lg shadow-blue-900/20"><i class="fas fa-plus text-xs"></i></button>
                    </div>
                    <div class="card-container overflow-hidden">
                        <table class="w-full text-xs">
                            <thead>
                                <tr><th class="text-left w-[25%]">Name</th><th class="text-right w-[10%]">Shares</th><th class="text-right w-[12%]">Strike</th><th class="text-right w-[12%]">FMV</th><th class="text-center w-[8%]">APY %</th><th class="text-center w-[8%]">Tax</th><th class="text-right w-[19%]">Net Equity</th><th class="w-6"></th></tr>
                            </thead>
                            <tbody id="stock-option-rows" class="mono-numbers"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Income Tab -->
            <section id="tab-income" class="tab-content hidden max-w-7xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">2026 Gross Income</p>
                        <p id="sum-gross-income" class="text-4xl font-black text-teal-400 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">MAGI (Taxable Base)</p>
                        <p id="sum-income-adjusted" class="text-4xl font-black text-blue-400 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">1st Year Retirement Income</p>
                        <p id="sum-retirement-income-floor" class="text-4xl font-black text-emerald-400 mono-numbers tracking-tight mb-2">$0</p>
                        <p id="sum-floor-breakdown" class="text-[9px] font-bold text-slate-500 uppercase tracking-widest"></p>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-8 px-1">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-xl bg-teal-500/20 flex items-center justify-center text-teal-400">
                            <i class="fas fa-money-bill-wave text-sm"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-white tracking-tight">Income Streams</h2>
                            <p class="text-xs text-slate-500 font-medium mt-0.5">W2, 1099, and Passive Income</p>
                        </div>
                    </div>
                    <button data-add-row="income-cards" data-row-type="income" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-all shadow-lg shadow-blue-900/20"><i class="fas fa-plus mr-2"></i>Add Stream</button>
                </div>
                <div id="income-cards" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </section>

            <!-- Budget Tab -->
            <section id="tab-budget" class="tab-content hidden max-w-7xl mx-auto">
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Annual Savings</p>
                        <p id="sum-budget-savings" class="text-4xl font-black text-emerald-400 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Annual Spend</p>
                        <p id="sum-budget-annual" class="text-4xl font-black text-pink-500 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Total Outflow</p>
                        <p id="sum-budget-total" class="text-4xl font-black text-blue-400 mono-numbers tracking-tight">$0</p>
                    </div>
                </div>

                <div class="mb-12">
                    <div class="flex items-center justify-between mb-6 px-1">
                        <div class="flex items-center gap-4">
                             <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400">
                                <i class="fas fa-piggy-bank text-sm"></i>
                             </div>
                             <div>
                                <h3 class="text-xl font-bold text-white tracking-tight">Annual Savings</h3>
                                <p class="text-xs text-slate-500 font-medium mt-0.5">Defined contributions and investments</p>
                             </div>
                        </div>
                        <button data-add-row="budget-savings-rows" data-row-type="budget-savings" class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors shadow-lg shadow-blue-900/20"><i class="fas fa-plus text-xs"></i></button>
                    </div>
                    <div class="card-container overflow-hidden">
                        <table class="w-full text-xs">
                            <thead>
                                <tr><th class="w-10 pl-6"></th><th class="text-left">Asset Class</th><th class="text-center w-28">Status</th><th class="text-right w-48">Monthly</th><th class="text-right w-48">Annual</th><th class="w-16 pr-8"></th></tr>
                            </thead>
                            <tbody id="budget-savings-rows" class="mono-numbers"></tbody>
                        </table>
                    </div>
                </div>

                <div class="mb-12">
                    <div class="flex items-center justify-between mb-6 px-1">
                        <div class="flex items-center gap-4">
                             <div class="w-10 h-10 rounded-xl bg-pink-500/20 flex items-center justify-center text-pink-500">
                                <i class="fas fa-chart-pie text-sm"></i>
                             </div>
                             <div>
                                <h3 class="text-xl font-bold text-white tracking-tight">Living Expenses</h3>
                                <p class="text-xs text-slate-500 font-medium mt-0.5">Monthly breakdown of costs</p>
                             </div>
                        </div>
                        <button data-add-row="budget-expenses-rows" data-row-type="budget-expense" class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors shadow-lg shadow-blue-900/20"><i class="fas fa-plus text-xs"></i></button>
                    </div>
                    <div class="card-container overflow-hidden">
                        <table class="w-full text-xs">
                            <thead>
                                <tr><th class="w-10 pl-6"></th><th class="text-left">Item Name</th><th class="text-center w-36">Config</th><th class="text-right w-48">Monthly</th><th class="text-right w-48">Annual</th><th class="w-16 pr-8"></th></tr>
                            </thead>
                            <tbody id="budget-expenses-rows" class="mono-numbers"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Assumptions Tab -->
            <section id="tab-assumptions" class="tab-content hidden max-w-7xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Years to Retirement</p>
                        <p id="sum-yrs-to-retire" class="text-4xl font-black text-blue-400 mono-numbers tracking-tight">0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Retirement Year 1 Budget</p>
                        <p id="sum-retire-budget" class="text-4xl font-black text-pink-500 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Est. Life Expectancy</p>
                        <p id="sum-life-exp" class="text-4xl font-black text-teal-400 mono-numbers tracking-none mb-2">0</p>
                        <p class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Per SSA Table</p>
                    </div>
                </div>

                <div class="flex items-center gap-4 mb-8 px-1">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400">
                        <i class="fas fa-sliders-h text-sm"></i>
                    </div>
                    <h2 class="text-xl font-bold text-white tracking-tight">Global Parameters</h2>
                </div>
                <div id="assumptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 p-8 card-container"></div>
            </section>

            <!-- Benefits Tab -->
            <section id="tab-benefits" class="tab-content hidden max-w-7xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Healthcare Plan</p>
                        <p id="sum-health-plan" class="text-4xl font-black text-slate-400 uppercase tracking-tight transition-colors">Private</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Est. SNAP (2026 Monthly)</p>
                        <p id="sum-snap-amt" class="text-4xl font-black text-emerald-400 mono-numbers tracking-tight">$0</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-4 mb-8 px-1">
                    <div class="w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center text-amber-400">
                        <i class="fas fa-hand-holding-heart text-sm"></i>
                    </div>
                    <h2 class="text-xl font-bold text-white tracking-tight">Benefit Optimization</h2>
                </div>

                <div id="benefits-module" class="space-y-8"></div>
            </section>

            <!-- Projection -->
            <section id="tab-projection" class="tab-content hidden max-w-7xl mx-auto">
                <div class="flex justify-between items-center mb-8 px-1">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
                            <i class="fas fa-chart-line text-sm"></i>
                        </div>
                        <h2 class="text-xl font-bold text-white tracking-tight">Strategic Projection</h2>
                    </div>
                    <div class="flex items-center gap-4">
                        <button id="toggle-projection-real" class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/5 rounded-lg label-std text-slate-400 hover:text-white transition-all">
                            <i class="fas fa-sync mr-2"></i> Real Dollars
                        </button>
                        <div class="flex items-center gap-3 bg-white/5 px-4 py-2 rounded-lg border border-white/5">
                            <span class="label-std text-slate-500">End Age: <span id="label-projection-end" class="text-blue-400 mono-numbers">72</span></span>
                            <input type="range" id="input-projection-end" min="70" max="100" value="72" class="w-24 h-1 bg-slate-700 rounded-full appearance-none cursor-pointer">
                        </div>
                    </div>
                </div>
                <div class="card-container p-6 mb-12 h-[500px] flex flex-col relative group">
                    <div class="flex-grow min-h-0">
                        <canvas id="projection-chart"></canvas>
                    </div>
                </div>
                <div id="projection-table-container" class="card-container overflow-hidden mb-12"></div>
            </section>

            <!-- Burndown -->
            <section id="tab-burndown" class="tab-content hidden max-w-7xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">First Year Solvency</p>
                        <p id="sum-solvency-age" class="text-4xl font-black text-emerald-400 mono-numbers tracking-tight">Age 100+</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p id="sum-draw-strategy-label" class="label-std mb-2 text-slate-500">Current Health Forecast</p>
                        <p id="sum-draw-strategy" class="text-4xl font-black text-slate-400 uppercase tracking-tight transition-colors">Private</p>
                    </div>
                </div>

                <div id="burndown-view-container" class="mb-12"></div>
                
                <div id="burndown-debug-container" class="p-8 bg-black/20 border border-white/5 rounded-[24px] shadow-inner mb-6">
                    <div class="flex items-center justify-between mb-4">
                         <div class="flex items-center gap-3">
                            <i class="fas fa-terminal text-blue-400"></i>
                            <h3 class="text-xs font-black text-white uppercase tracking-widest">Advanced Logic Trace</h3>
                         </div>
                         <div class="flex items-center gap-3">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Age:</label>
                            <div class="bg-black/40 rounded-lg p-1 flex items-center gap-1">
                                <button id="btn-debug-minus" class="w-6 h-6 flex items-center justify-center hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors"><i class="fas fa-minus text-[10px]"></i></button>
                                <input type="number" id="input-debug-age" min="30" max="100" placeholder="Age" class="bg-transparent border-none text-xs text-blue-400 font-bold outline-none w-10 text-center mono-numbers">
                                <button id="btn-debug-plus" class="w-6 h-6 flex items-center justify-center hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors"><i class="fas fa-plus text-[10px]"></i></button>
                            </div>
                         </div>
                    </div>
                    <div id="burndown-trace-log" class="text-[11px] font-mono leading-relaxed text-slate-400 bg-black/40 p-6 rounded-xl border border-white/5 max-h-[400px] overflow-y-auto whitespace-pre-wrap">
                        Select an age or run simulation to see logic trace...
                    </div>
                </div>

                <!-- Engine Documentation -->
                <div class="flex flex-col items-center">
                    <button id="btn-toggle-engine-doc" class="px-6 py-3 bg-slate-800 border border-slate-700 hover:bg-slate-700 text-slate-400 hover:text-white rounded-xl text-[10px] font-black uppercase tracking-widest transition-all mb-4">
                        <i class="fas fa-chevron-down mr-2"></i> Show Calculation Stages
                    </button>
                    
                    <div id="engine-logic-doc" class="hidden w-full max-w-4xl bg-slate-900/40 border border-white/5 rounded-[32px] p-8 md:p-12 space-y-12">
                        <!-- Stage 1 -->
                        <div class="space-y-6">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 font-black text-sm">1</div>
                                <h4 class="text-xl font-black text-white tracking-tight uppercase">Stage 1: Prior to Retirement (Accumulation Build)</h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pl-14">
                                <div class="space-y-4">
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">A: Gross Inflow</p>
                                        <p class="text-sm text-slate-300">The engine sums all W2 and 1099 income streams based on your current age and projected growth percentages.</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">B: The Siphon Effect</p>
                                        <p class="text-sm text-slate-300">Pre-tax contributions (401k/HSA) are subtracted from gross income to calculate the <strong>MAGI Base</strong>. These funds are added directly to your account balances.</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">C: Tax Leakage</p>
                                        <p class="text-sm text-slate-300">Federal, State, and FICA taxes are calculated on the remaining taxable portion of your income.</p>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">D: Excess Cash Disposal</p>
                                        <p class="text-sm text-slate-300">The engine solves for surplus: <code class="text-teal-400">Income - Taxes - Budget - Savings = Excess Cash</code>. This surplus is automatically routed to your <strong>Taxable Brokerage</strong> bucket.</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">E: The Compounding Loop</p>
                                        <p class="text-sm text-slate-300">Each year, the engine applies your specific APY settings (Stock, Crypto, RE) to existing balances <em>before</em> adding the current year's contributions.</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">F: Inflation Scaling</p>
                                        <p class="text-sm text-slate-300">Your budget, IRS contribution limits, and FPL benefit thresholds are increased annually according to your inflation setting.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stage 2 -->
                        <div class="space-y-6">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-black text-sm">2</div>
                                <h4 class="text-xl font-black text-white tracking-tight uppercase">Stage 2: Starting Retirement (The Bridge Phase)</h4>
                            </div>
                            <div class="pl-14 space-y-6">
                                <p class="text-sm text-blue-300 font-bold italic leading-relaxed">This phase is critical for FIRE planning. Since users are typically under age 59.5, the engine must solve for the cash shortfall without triggering early withdrawal penalties.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div class="space-y-4">
                                        <div class="space-y-1">
                                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">A: The Bridge Audit</p>
                                            <p class="text-sm text-slate-300">Before touching the 401k, the tool performs a full audit of your other liquid pots (Cash, Brokerage, Crypto, Metals, Roth Basis, and HELOC). If these pots fail to cover the budget, a <strong>72(t) / SEPP</strong> systematic withdrawal is triggered.</p>
                                        </div>
                                        <div class="space-y-1">
                                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">B: MAGI Strategy Targeting</p>
                                            <p class="text-sm text-slate-300">The tool targets specific "Sweet Spots" (Platinum or Silver zones) using your Strategy Dial to maximize ACA subsidies while raising necessary cash.</p>
                                        </div>
                                    </div>
                                    <div class="space-y-4">
                                        <div class="space-y-1">
                                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">C: The Withdrawal Waterfall</p>
                                            <p class="text-sm text-slate-300">Assets are drained in a specific sequence to maintain the tax strategy: <code class="text-white">Cash â†’ Brokerage Basis â†’ Brokerage Gains â†’ HELOC â†’ 72(t)</code>.</p>
                                        </div>
                                        <div class="space-y-1">
                                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">D: 3-Pass Tax Spiral</p>
                                            <p class="text-sm text-slate-300">Withdrawals generate taxes, which create more shortfall. The engine runs 3 iterative passes per year to "gross up" the final withdrawal and cover the resulting tax bill.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stage 3 -->
                        <div class="space-y-6">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400 font-black text-sm">3</div>
                                <h4 class="text-xl font-black text-white tracking-tight uppercase">Stage 3: Social Security & Beyond (The Legacy Phase)</h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pl-14">
                                <div class="space-y-4">
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">A: Social Security Floor</p>
                                        <p class="text-sm text-slate-300">The engine calculates your provisional income to determine how much of your Social Security benefit is taxable ordinary income.</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">B: RMD Triggering</p>
                                        <p class="text-sm text-slate-300">At age 75, the engine triggers Required Minimum Distributions, forcing taxable withdrawals from Pre-Tax buckets regardless of cash need.</p>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">C: Medicare Transition</p>
                                        <p class="text-sm text-slate-300">Healthcare logic automatically switches from MAGI-based ACA subsidies to standard Medicare logic at age 65.</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">D: Final Solvency Check</p>
                                        <p class="text-sm text-slate-300">If total liquid assets drop below $0 at any point, the engine marks the year as <strong>INSOLVENT</strong> and flags the "Solvency Cliff" in the projection chart.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Dynamic import -->
    <script type="module">
        import "./main.js?v=2.6"; 
    </script>
</body>
</html>