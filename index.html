<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>FIRECalc</title>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const isForcedMobile = urlParams.get('force') === 'true';
        const isForcedDesktop = urlParams.get('desktop') === 'true' || window.location.search.includes('desktop');

        if ((window.innerWidth < 768 || isForcedMobile) && !isForcedDesktop) {
            window.location.href = 'mobile.html' + window.location.search;
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“ˆ</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    <style>
        /* Globally hide broken images so they dont show the 'alt' text and broken icon */
        img:-moz-broken, img:invalid {
            display: none !important;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
        "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
        "react/": "https://esm.sh/react@^19.2.3/",
        "react": "https://esm.sh/react@^19.2.3"
      }
    }
    </script>
</head>
<body class="text-slate-300 bg-[#0B0F19] font-inter">

    <!-- Loading State -->
    <div id="login-screen" class="fixed inset-0 flex items-center justify-center bg-[#0B0F19] z-50">
        <div class="p-8 text-center w-full">
            <h1 class="text-4xl font-black mb-2 text-white tracking-tighter">FIRECalc</h1>
            <div class="flex items-center justify-center gap-3 text-blue-500 font-bold uppercase tracking-widest text-xs mt-8">
                <i class="fas fa-circle-notch fa-spin text-lg"></i>
                Authenticating...
            </div>
        </div>
    </div>

    <!-- Guest Warning Modal -->
    <div id="guest-modal" class="fixed inset-0 flex items-center justify-center bg-black/80 z-[60] hidden backdrop-blur-sm">
        <div class="glass-panel p-8 rounded-[24px] shadow-2xl max-w-md text-center mx-4 relative">
            <div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-white/10">
                <i class="fas fa-hdd text-3xl text-blue-400"></i>
            </div>
            <h2 class="text-2xl font-black text-white mb-2 tracking-tight">Guest Mode</h2>
            <p class="text-slate-400 text-sm leading-relaxed mb-8">
                Data is stored <strong class="text-white">locally on this device</strong>. <br>
                Clear your cache and it's gone.
            </p>
            <button id="ack-guest-btn" class="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold transition-all shadow-lg shadow-blue-900/20 uppercase tracking-widest text-xs">
                I Understand
            </button>
        </div>
    </div>

    <!-- Profile Selection Modal -->
    <div id="profile-modal" class="fixed inset-0 flex items-center justify-center bg-black/90 z-[65] hidden backdrop-blur-md">
        <div class="glass-panel p-10 rounded-[40px] shadow-2xl max-w-6xl w-full mx-4 text-center border border-white/10">
            <h2 class="text-4xl font-black text-white mb-3 tracking-tighter">Choose Your Starting Point</h2>
            <p class="text-slate-400 text-sm mb-12 font-medium">Select a life stage to begin your simulation.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- 25 YO: The Starter -->
                <button data-profile="25" class="group relative p-8 bg-slate-900/40 hover:bg-slate-800/60 border border-white/10 rounded-[32px] transition-all hover:scale-[1.02] hover:shadow-2xl hover:shadow-teal-900/20 flex flex-col items-center">
                    <div class="absolute top-6 right-8 opacity-5 group-hover:opacity-10 transition-opacity"><i class="fas fa-rocket text-7xl text-teal-400"></i></div>
                    
                    <!-- Icon Frame: Precision Centering -->
                    <div class="relative w-40 h-40 rounded-full flex items-center justify-center mb-8 bg-black/20">
                        <div class="absolute inset-0 rounded-full bg-teal-500/10 blur-2xl group-hover:bg-teal-500/20 transition-all"></div>
                        <div class="absolute inset-0 rounded-full border-2 border-teal-500/20 group-hover:border-teal-500/50 transition-all"></div>
                        <div class="absolute inset-2 rounded-full bg-gradient-to-b from-white/5 to-transparent"></div>
                        
                        <!-- Image: Absolute Centered with max constraints -->
                        <img src="starter.png" alt="" class="relative z-20 max-w-[85%] max-h-[85%] object-contain drop-shadow-[0_20px_20px_rgba(0,0,0,0.5)] transition-transform duration-500 group-hover:scale-110">
                    </div>

                    <h3 class="text-2xl font-black text-white mb-1 tracking-tight">The Starter</h3>
                    <p class="text-[10px] text-teal-400 font-black uppercase tracking-widest mb-8">Age 25 â€¢ Single</p>
                    
                    <div class="w-full space-y-4 text-xs text-slate-400 border-t border-white/5 pt-8">
                        <div class="flex justify-between items-center"><span class="font-medium">Income</span><span class="text-white font-black">$120k</span></div>
                        <div class="flex justify-between items-center"><span class="font-medium">Net Worth</span><span class="text-white font-black">$40k</span></div>
                        <div class="flex justify-between items-center"><span class="font-medium">Housing</span><span class="text-white font-black">Renting</span></div>
                    </div>
                </button>

                <!-- 40 YO: The Accumulator -->
                <button data-profile="40" class="group relative p-8 bg-slate-900/40 hover:bg-slate-800/60 border border-blue-500/30 rounded-[32px] transition-all hover:scale-[1.02] hover:shadow-2xl hover:shadow-blue-900/30 flex flex-col items-center">
                    <div class="absolute top-6 right-8 opacity-5 group-hover:opacity-10 transition-opacity"><i class="fas fa-users text-7xl text-blue-400"></i></div>
                    
                    <div class="relative w-40 h-40 rounded-full flex items-center justify-center mb-8 bg-black/20">
                        <div class="absolute inset-0 rounded-full bg-blue-500/10 blur-2xl group-hover:bg-blue-500/20 transition-all"></div>
                        <div class="absolute inset-0 rounded-full border-2 border-blue-500/40 group-hover:border-blue-500/70 transition-all"></div>
                        <div class="absolute inset-2 rounded-full bg-gradient-to-b from-white/5 to-transparent"></div>
                        
                        <img src="couple.png" alt="" class="relative z-20 max-w-[85%] max-h-[85%] object-contain drop-shadow-[0_20px_20px_rgba(0,0,0,0.5)] transition-transform duration-500 group-hover:scale-110">
                    </div>

                    <h3 class="text-2xl font-black text-white mb-1 tracking-tight">Accumulator</h3>
                    <p class="text-[10px] text-blue-400 font-black uppercase tracking-widest mb-8">Age 40 â€¢ Married â€¢ 3 Kids</p>
                    
                    <div class="w-full space-y-4 text-xs text-slate-400 border-t border-white/5 pt-8">
                        <div class="flex justify-between items-center"><span class="font-medium">HH Income</span><span class="text-white font-black">$325k</span></div>
                        <div class="flex justify-between items-center"><span class="font-medium">Net Worth</span><span class="text-white font-black">$1.5M</span></div>
                        <div class="flex justify-between items-center"><span class="font-medium">Housing</span><span class="text-white font-black">Mortgage</span></div>
                    </div>
                </button>

                <!-- 55 YO: Pre-Retiree -->
                <button data-profile="55" class="group relative p-8 bg-slate-900/40 hover:bg-slate-800/60 border border-white/10 rounded-[32px] transition-all hover:scale-[1.02] hover:shadow-2xl hover:shadow-purple-900/20 flex flex-col items-center">
                    <div class="absolute top-6 right-8 opacity-5 group-hover:opacity-10 transition-opacity"><i class="fas fa-umbrella-beach text-7xl text-purple-400"></i></div>
                    
                    <div class="relative w-40 h-40 rounded-full flex items-center justify-center mb-8 bg-black/20">
                        <div class="absolute inset-0 rounded-full bg-purple-500/10 blur-2xl group-hover:bg-purple-500/20 transition-all"></div>
                        <div class="absolute inset-0 rounded-full border-2 border-purple-500/20 group-hover:border-purple-500/50 transition-all"></div>
                        <div class="absolute inset-2 rounded-full bg-gradient-to-b from-white/5 to-transparent"></div>
                        
                        <img src="retiree.png" alt="" class="relative z-20 max-w-[85%] max-h-[85%] object-contain drop-shadow-[0_20px_20px_rgba(0,0,0,0.5)] transition-transform duration-500 group-hover:scale-110">
                    </div>

                    <h3 class="text-2xl font-black text-white mb-1 tracking-tight">Pre-Retiree</h3>
                    <p class="text-[10px] text-purple-400 font-black uppercase tracking-widest mb-8">Age 55 â€¢ Married</p>
                    
                    <div class="w-full space-y-4 text-xs text-slate-400 border-t border-white/5 pt-8">
                        <div class="flex justify-between items-center"><span class="font-medium">HH Income</span><span class="text-white font-black">$298k+</span></div>
                        <div class="flex justify-between items-center"><span class="font-medium">Net Worth</span><span class="text-white font-black">$2.9M</span></div>
                        <div class="flex justify-between items-center"><span class="font-medium">Housing</span><span class="text-white font-black">Paid Off</span></div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden flex h-screen overflow-hidden relative">
        <!-- Sidebar and Content remains unchanged -->
        <aside class="sidebar w-64 flex flex-col flex-shrink-0 bg-[#0B0F19]/80 backdrop-blur-xl border-r border-white/5 z-20">
            <!-- ... sidebar content ... -->
            <div class="p-6 pb-2">
                <div class="flex items-center justify-between mb-1">
                    <h1 class="text-xl font-black text-white tracking-tight">FIRECalc</h1>
                    <div class="flex items-center gap-1.5">
                        <span class="text-[9px] font-black text-amber-500 uppercase tracking-widest">Donate:</span>
                        <a href="https://buymeacoffee.com/timdegraff" target="_blank" class="text-amber-500 hover:text-amber-400 transition-colors text-xs" title="Buy me a coffee">
                            <i class="fas fa-coffee"></i>
                        </a>
                    </div>
                </div>
                <p class="label-std text-slate-500">Retirement Engine</p>
            </div>
            
            <nav class="flex-grow px-3 py-2 space-y-1 overflow-y-auto" id="main-nav">
                <button data-tab="assets-debts" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-wallet w-5 text-center text-orange-400"></i><span>Assets</span></button>
                <button data-tab="income" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-money-bill-wave w-5 text-center text-teal-400"></i><span>Income</span></button>
                <button data-tab="budget" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-chart-pie w-5 text-center text-pink-500"></i><span>Budget</span></button>
                <button data-tab="assumptions" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-sliders-h w-5 text-center text-emerald-400"></i><span>Assumptions</span></button>
                <button data-tab="benefits" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-hand-holding-heart w-5 text-center text-amber-400"></i><span>Benefits</span></button>
                <button data-tab="projection" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-chart-line w-5 text-center text-blue-400"></i><span>Projection</span></button>
                <button data-tab="burndown" class="tab-btn w-full text-left p-3 flex items-center gap-3"><i class="fas fa-stairs w-5 text-center text-purple-400" style="transform: scaleX(-1);"></i><span>Burndown</span></button>
            </nav>
            
            <div class="p-4 border-t border-white/5 bg-black/10">
                <div class="mb-4">
                    <p class="label-std text-slate-500 mb-1">Net Worth</p>
                    <p id="sidebar-networth" class="text-lg font-black text-emerald-400 tracking-tight mono-numbers">$0</p>
                    <div id="sidebar-asset-legend" class="grid grid-cols-2 gap-x-4 gap-y-1 w-full mt-3"></div>
                </div>
                <div class="flex items-center gap-3 mb-3">
                    <img id="user-avatar" class="w-8 h-8 rounded-full border border-white/10" src="" alt="">
                    <p id="user-name" class="font-bold text-slate-300 text-[11px] truncate"></p>
                </div>
                <div class="flex gap-2">
                    <div id="save-indicator" class="flex-1 py-1.5 bg-white/5 rounded-lg text-center flex items-center justify-center gap-1 border border-white/5 text-slate-600 transition-colors duration-200" title="Data Sync Status">
                        <i class="fas fa-cloud text-xs"></i>
                    </div>
                    <button id="logout-btn" class="flex-[3] py-1.5 bg-white/5 hover:bg-red-500/20 text-slate-400 hover:text-red-400 rounded-lg text-[10px] font-bold uppercase tracking-wider transition-colors border border-white/5">Logout</button>
                </div>
            </div>
        </aside>

        <main class="main-content flex-grow p-6 md:p-8 overflow-y-auto bg-[#0B0F19]">
            <!-- Content here remains same -->
            <section id="tab-assets-debts" class="tab-content max-w-7xl mx-auto">
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Total Assets</p>
                        <p id="sum-assets" class="text-4xl font-black text-emerald-400 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28">
                        <p class="label-std mb-2 text-slate-500">Total Liabilities</p>
                        <p id="sum-liabilities" class="text-4xl font-black text-red-400 mono-numbers tracking-tight">$0</p>
                    </div>
                    <div class="card-container p-6 flex flex-col items-center justify-center h-28 relative overflow-hidden group">
                        <div class="absolute inset-0 bg-teal-500/5 group-hover:bg-teal-500/10 transition-colors"></div>
                        <p class="label-std mb-2 text-teal-500">Net Worth</p>
                        <p id="sum-networth" class="text-4xl font-black text-teal-400 mono-numbers tracking-tight relative z-10">$0</p>
                    </div>
                </div>
                <!-- ... other assets section ... -->
            </section>
            <!-- ... other sections ... -->
        </main>
    </div>

    <!-- Dynamic import -->
    <script type="module">
        import "./main.js?v=3.0"; 
    </script>
</body>
</html>